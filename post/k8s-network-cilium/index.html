<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>kubeadm + Cilium æ­å»ºkubernetesé›†ç¾¤ - Mykiçš„åšå®¢</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-2427629508597494",enable_page_level_ads:true});</script><meta name=author content="ğŸ³Myki"><meta name=description content="ä¸å¾—ä¸è¯´çš„kubeadm 
kubeadméƒ¨ç½²å¾ˆæ–¹ä¾¿,ä½†æ˜¯æ˜¯ä¸€ä¸ªè€å¤–å†™çš„,ä½¿ç”¨staticPod(å®¹å™¨)è¿è¡Œçš„ç®¡ç†ç»„ä»¶,é•œåƒéƒ½æ˜¯gcr.ioåŸŸåä»“åº“é‡Œçš„ã€‚
åŸŸåä»“åº“å¾ˆå¤šdockerçš„äººç”šè‡³éƒ½ä¸çŸ¥é“,dockeré•œåƒå‘½åè§„åˆ™æ˜¯åŸŸå/åº“å/img_name:tagè¿™ç§å½¢å¼,dockerhubä¸Šè¦æ‹‰å–é•œåƒç›´æ¥æ˜¯åº“å/img_name:tagè¿™ç§åå­—,æ˜¯å› ä¸ºåŸŸåç¼ºçœæ˜¯docker.ioä¹Ÿå°±æ˜¯dockerhubä¸Šçœ‹åˆ°çš„éƒ½æ˜¯è¿™ä¸ªåŸŸåä»“åº“çš„
å¸¸è§çš„åŸŸåä»“åº“å›½å¤–æœ‰gcr.io,quay.io,å›½å†…çš„é˜¿é‡Œ(registry.cn-hangzhou.aliyuncs.com,hangzhouä»¥å¤–è¿˜æœ‰shenzhenå•¥çš„),daocloud.ioç­‰ç­‰.gcr.ioå› ä¸ºä½ç½®åœ¨å›½å¤–ä¼šæ‹‰å–ä¸åˆ°.å›½å†…é˜¿é‡Œä»“åº“åŒæ­¥äº†gcr.io/google_containersè¿™äº›é•œåƒ,
æ€»æœ‰äººè®¤ä¸ºkubeadmçš„å®¹å™¨è¿è¡Œæ²¡æœ‰äºŒè¿›åˆ¶è¿è¡Œæ”¾å¿ƒ.å®¹å™¨æœ¬èº«å°±æ˜¯ä¸ªéš”ç¦»å—é™çš„è¿›ç¨‹,å¦å¤–ç®¡ç†ç»„ä»¶éƒ½æ˜¯æ— çŠ¶æ€çš„,ä½†æ˜¯ä»–ä»¬æ€»æ„Ÿè§‰ä¸æ”¾å¿ƒã€‚
äº‹å®ä¸Šé™¤äº†kubeletä»¥å¤–æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ç”¨å®¹å™¨æ–¹å¼è¿è¡Œ,ç®¡ç†ç»„ä»¶ç®€å•è¯´ä¸‹å°±æ˜¯é›†ç¾¤æ•°æ®å­˜æ”¾etcdæ•°æ®åº“é‡Œ,apiserverå»å’Œetcdäº¤äº’,å…¶ä»–ç»„ä»¶å’Œapiserveräº¤äº’,kubeletè°ƒç”¨apiå»æ“ä½œdocker,å…¶ä¸­ä¸€äº›ç»„ä»¶ä¹Ÿä¼šå»æ“ä½œå„ä¸ªèŠ‚ç‚¹çš„ç³»ç»Ÿè®¾ç½®
ererere"><meta name=keywords content="kubernetes,coredns"><meta name=generator content="Hugo 0.74.3 with theme even"><link rel=canonical href=https://www.1nth.com/post/k8s-network-cilium/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><link href=/sass/main.min.b5b9c0f253defc99c13b35448ffb4214367d80b2b1237dfac18a4a76d034c663.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><link rel=stylesheet href=/css/custom.css><meta property="og:title" content="kubeadm + Cilium æ­å»ºkubernetesé›†ç¾¤"><meta property="og:description" content="ä¸å¾—ä¸è¯´çš„kubeadm
kubeadméƒ¨ç½²å¾ˆæ–¹ä¾¿,ä½†æ˜¯æ˜¯ä¸€ä¸ªè€å¤–å†™çš„,ä½¿ç”¨staticPod(å®¹å™¨)è¿è¡Œçš„ç®¡ç†ç»„ä»¶,é•œåƒéƒ½æ˜¯gcr.ioåŸŸåä»“åº“é‡Œçš„ã€‚åŸŸåä»“åº“å¾ˆå¤šdockerçš„äººç”šè‡³éƒ½ä¸çŸ¥é“,dockeré•œåƒå‘½åè§„åˆ™æ˜¯åŸŸå/åº“å/img_name:tagè¿™ç§å½¢å¼,dockerhubä¸Šè¦æ‹‰å–é•œåƒç›´æ¥æ˜¯åº“å/img_name:tagè¿™ç§åå­—,æ˜¯å› ä¸ºåŸŸåç¼ºçœæ˜¯docker.ioä¹Ÿå°±æ˜¯dockerhubä¸Šçœ‹åˆ°çš„éƒ½æ˜¯è¿™ä¸ªåŸŸåä»“åº“çš„å¸¸è§çš„åŸŸåä»“åº“å›½å¤–æœ‰gcr.io,quay.io,å›½å†…çš„é˜¿é‡Œ(registry.cn-hangzhou.aliyuncs.com,hangzhouä»¥å¤–è¿˜æœ‰shenzhenå•¥çš„),daocloud.ioç­‰ç­‰.gcr.ioå› ä¸ºä½ç½®åœ¨å›½å¤–ä¼šæ‹‰å–ä¸åˆ°.å›½å†…é˜¿é‡Œä»“åº“åŒæ­¥äº†gcr.io/google_containersè¿™äº›é•œåƒ,
æ€»æœ‰äººè®¤ä¸ºkubeadmçš„å®¹å™¨è¿è¡Œæ²¡æœ‰äºŒè¿›åˆ¶è¿è¡Œæ”¾å¿ƒ.å®¹å™¨æœ¬èº«å°±æ˜¯ä¸ªéš”ç¦»å—é™çš„è¿›ç¨‹,å¦å¤–ç®¡ç†ç»„ä»¶éƒ½æ˜¯æ— çŠ¶æ€çš„,ä½†æ˜¯ä»–ä»¬æ€»æ„Ÿè§‰ä¸æ”¾å¿ƒã€‚äº‹å®ä¸Šé™¤äº†kubeletä»¥å¤–æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ç”¨å®¹å™¨æ–¹å¼è¿è¡Œ,ç®¡ç†ç»„ä»¶ç®€å•è¯´ä¸‹å°±æ˜¯é›†ç¾¤æ•°æ®å­˜æ”¾etcdæ•°æ®åº“é‡Œ,apiserverå»å’Œetcdäº¤äº’,å…¶ä»–ç»„ä»¶å’Œapiserveräº¤äº’,kubeletè°ƒç”¨apiå»æ“ä½œdocker,å…¶ä¸­ä¸€äº›ç»„ä»¶ä¹Ÿä¼šå»æ“ä½œå„ä¸ªèŠ‚ç‚¹çš„ç³»ç»Ÿè®¾ç½®ererere"><meta property="og:type" content="article"><meta property="og:url" content="https://www.1nth.com/post/k8s-network-cilium/"><meta property="article:published_time" content="2020-09-13T00:00:00+00:00"><meta property="article:modified_time" content="2020-09-13T00:00:00+00:00"><meta itemprop=name content="kubeadm + Cilium æ­å»ºkubernetesé›†ç¾¤"><meta itemprop=description content="ä¸å¾—ä¸è¯´çš„kubeadm
kubeadméƒ¨ç½²å¾ˆæ–¹ä¾¿,ä½†æ˜¯æ˜¯ä¸€ä¸ªè€å¤–å†™çš„,ä½¿ç”¨staticPod(å®¹å™¨)è¿è¡Œçš„ç®¡ç†ç»„ä»¶,é•œåƒéƒ½æ˜¯gcr.ioåŸŸåä»“åº“é‡Œçš„ã€‚åŸŸåä»“åº“å¾ˆå¤šdockerçš„äººç”šè‡³éƒ½ä¸çŸ¥é“,dockeré•œåƒå‘½åè§„åˆ™æ˜¯åŸŸå/åº“å/img_name:tagè¿™ç§å½¢å¼,dockerhubä¸Šè¦æ‹‰å–é•œåƒç›´æ¥æ˜¯åº“å/img_name:tagè¿™ç§åå­—,æ˜¯å› ä¸ºåŸŸåç¼ºçœæ˜¯docker.ioä¹Ÿå°±æ˜¯dockerhubä¸Šçœ‹åˆ°çš„éƒ½æ˜¯è¿™ä¸ªåŸŸåä»“åº“çš„å¸¸è§çš„åŸŸåä»“åº“å›½å¤–æœ‰gcr.io,quay.io,å›½å†…çš„é˜¿é‡Œ(registry.cn-hangzhou.aliyuncs.com,hangzhouä»¥å¤–è¿˜æœ‰shenzhenå•¥çš„),daocloud.ioç­‰ç­‰.gcr.ioå› ä¸ºä½ç½®åœ¨å›½å¤–ä¼šæ‹‰å–ä¸åˆ°.å›½å†…é˜¿é‡Œä»“åº“åŒæ­¥äº†gcr.io/google_containersè¿™äº›é•œåƒ,
æ€»æœ‰äººè®¤ä¸ºkubeadmçš„å®¹å™¨è¿è¡Œæ²¡æœ‰äºŒè¿›åˆ¶è¿è¡Œæ”¾å¿ƒ.å®¹å™¨æœ¬èº«å°±æ˜¯ä¸ªéš”ç¦»å—é™çš„è¿›ç¨‹,å¦å¤–ç®¡ç†ç»„ä»¶éƒ½æ˜¯æ— çŠ¶æ€çš„,ä½†æ˜¯ä»–ä»¬æ€»æ„Ÿè§‰ä¸æ”¾å¿ƒã€‚äº‹å®ä¸Šé™¤äº†kubeletä»¥å¤–æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ç”¨å®¹å™¨æ–¹å¼è¿è¡Œ,ç®¡ç†ç»„ä»¶ç®€å•è¯´ä¸‹å°±æ˜¯é›†ç¾¤æ•°æ®å­˜æ”¾etcdæ•°æ®åº“é‡Œ,apiserverå»å’Œetcdäº¤äº’,å…¶ä»–ç»„ä»¶å’Œapiserveräº¤äº’,kubeletè°ƒç”¨apiå»æ“ä½œdocker,å…¶ä¸­ä¸€äº›ç»„ä»¶ä¹Ÿä¼šå»æ“ä½œå„ä¸ªèŠ‚ç‚¹çš„ç³»ç»Ÿè®¾ç½®ererere"><meta itemprop=datePublished content="2020-09-13T00:00:00+00:00"><meta itemprop=dateModified content="2020-09-13T00:00:00+00:00"><meta itemprop=wordCount content="5799"><meta itemprop=keywords content="kubernetes,"><meta name=twitter:card content="summary"><meta name=twitter:title content="kubeadm + Cilium æ­å»ºkubernetesé›†ç¾¤"><meta name=twitter:description content="ä¸å¾—ä¸è¯´çš„kubeadm
kubeadméƒ¨ç½²å¾ˆæ–¹ä¾¿,ä½†æ˜¯æ˜¯ä¸€ä¸ªè€å¤–å†™çš„,ä½¿ç”¨staticPod(å®¹å™¨)è¿è¡Œçš„ç®¡ç†ç»„ä»¶,é•œåƒéƒ½æ˜¯gcr.ioåŸŸåä»“åº“é‡Œçš„ã€‚åŸŸåä»“åº“å¾ˆå¤šdockerçš„äººç”šè‡³éƒ½ä¸çŸ¥é“,dockeré•œåƒå‘½åè§„åˆ™æ˜¯åŸŸå/åº“å/img_name:tagè¿™ç§å½¢å¼,dockerhubä¸Šè¦æ‹‰å–é•œåƒç›´æ¥æ˜¯åº“å/img_name:tagè¿™ç§åå­—,æ˜¯å› ä¸ºåŸŸåç¼ºçœæ˜¯docker.ioä¹Ÿå°±æ˜¯dockerhubä¸Šçœ‹åˆ°çš„éƒ½æ˜¯è¿™ä¸ªåŸŸåä»“åº“çš„å¸¸è§çš„åŸŸåä»“åº“å›½å¤–æœ‰gcr.io,quay.io,å›½å†…çš„é˜¿é‡Œ(registry.cn-hangzhou.aliyuncs.com,hangzhouä»¥å¤–è¿˜æœ‰shenzhenå•¥çš„),daocloud.ioç­‰ç­‰.gcr.ioå› ä¸ºä½ç½®åœ¨å›½å¤–ä¼šæ‹‰å–ä¸åˆ°.å›½å†…é˜¿é‡Œä»“åº“åŒæ­¥äº†gcr.io/google_containersè¿™äº›é•œåƒ,
æ€»æœ‰äººè®¤ä¸ºkubeadmçš„å®¹å™¨è¿è¡Œæ²¡æœ‰äºŒè¿›åˆ¶è¿è¡Œæ”¾å¿ƒ.å®¹å™¨æœ¬èº«å°±æ˜¯ä¸ªéš”ç¦»å—é™çš„è¿›ç¨‹,å¦å¤–ç®¡ç†ç»„ä»¶éƒ½æ˜¯æ— çŠ¶æ€çš„,ä½†æ˜¯ä»–ä»¬æ€»æ„Ÿè§‰ä¸æ”¾å¿ƒã€‚äº‹å®ä¸Šé™¤äº†kubeletä»¥å¤–æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ç”¨å®¹å™¨æ–¹å¼è¿è¡Œ,ç®¡ç†ç»„ä»¶ç®€å•è¯´ä¸‹å°±æ˜¯é›†ç¾¤æ•°æ®å­˜æ”¾etcdæ•°æ®åº“é‡Œ,apiserverå»å’Œetcdäº¤äº’,å…¶ä»–ç»„ä»¶å’Œapiserveräº¤äº’,kubeletè°ƒç”¨apiå»æ“ä½œdocker,å…¶ä¸­ä¸€äº›ç»„ä»¶ä¹Ÿä¼šå»æ“ä½œå„ä¸ªèŠ‚ç‚¹çš„ç³»ç»Ÿè®¾ç½®ererere"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>â˜¸ğŸ’•ğŸš©</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>â˜¸ğŸ’•ğŸš©</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>kubeadm + Cilium æ­å»ºkubernetesé›†ç¾¤</h1><div class=post-meta><span class=post-time>2020-09-13</span><div class=post-category><a href=/categories/kubernetes/>kubernetes</a>
<a href=/categories/coredns/>coredns</a></div><span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> æ¬¡é˜…è¯»</span></div></header><div class=post-content><p><a name=6ed7c9be></a></p><h2 id=ä¸å¾—ä¸è¯´çš„kubeadm>ä¸å¾—ä¸è¯´çš„kubeadm</h2><p><br>kubeadméƒ¨ç½²å¾ˆæ–¹ä¾¿,ä½†æ˜¯æ˜¯ä¸€ä¸ªè€å¤–å†™çš„,ä½¿ç”¨staticPod(å®¹å™¨)è¿è¡Œçš„ç®¡ç†ç»„ä»¶,é•œåƒéƒ½æ˜¯<code>gcr.io</code>åŸŸåä»“åº“é‡Œçš„ã€‚<br>åŸŸåä»“åº“å¾ˆå¤šdockerçš„äººç”šè‡³éƒ½ä¸çŸ¥é“,dockeré•œåƒå‘½åè§„åˆ™æ˜¯<code>åŸŸå/åº“å/img_name:tag</code>è¿™ç§å½¢å¼,dockerhubä¸Šè¦æ‹‰å–é•œåƒç›´æ¥æ˜¯<code>åº“å/img_name:tag</code>è¿™ç§åå­—,æ˜¯å› ä¸ºåŸŸåç¼ºçœæ˜¯<code>docker.io</code>ä¹Ÿå°±æ˜¯dockerhubä¸Šçœ‹åˆ°çš„éƒ½æ˜¯è¿™ä¸ªåŸŸåä»“åº“çš„<br>å¸¸è§çš„åŸŸåä»“åº“å›½å¤–æœ‰gcr.io,quay.io,å›½å†…çš„é˜¿é‡Œ(registry.cn-hangzhou.aliyuncs.com,hangzhouä»¥å¤–è¿˜æœ‰shenzhenå•¥çš„),daocloud.ioç­‰ç­‰.gcr.ioå› ä¸ºä½ç½®åœ¨å›½å¤–ä¼šæ‹‰å–ä¸åˆ°.å›½å†…é˜¿é‡Œä»“åº“åŒæ­¥äº†<code>gcr.io/google_containers</code>è¿™äº›é•œåƒ,<br><br>æ€»æœ‰äººè®¤ä¸ºkubeadmçš„å®¹å™¨è¿è¡Œæ²¡æœ‰äºŒè¿›åˆ¶è¿è¡Œæ”¾å¿ƒ.å®¹å™¨æœ¬èº«å°±æ˜¯ä¸ªéš”ç¦»å—é™çš„è¿›ç¨‹,å¦å¤–ç®¡ç†ç»„ä»¶éƒ½æ˜¯æ— çŠ¶æ€çš„,ä½†æ˜¯ä»–ä»¬æ€»æ„Ÿè§‰ä¸æ”¾å¿ƒã€‚<br>äº‹å®ä¸Šé™¤äº†kubeletä»¥å¤–æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ç”¨å®¹å™¨æ–¹å¼è¿è¡Œ,ç®¡ç†ç»„ä»¶ç®€å•è¯´ä¸‹å°±æ˜¯é›†ç¾¤æ•°æ®å­˜æ”¾<code>etcd</code>æ•°æ®åº“é‡Œ,apiserverå»å’Œetcdäº¤äº’,å…¶ä»–ç»„ä»¶å’Œapiserveräº¤äº’,kubeletè°ƒç”¨apiå»æ“ä½œdocker,å…¶ä¸­ä¸€äº›ç»„ä»¶ä¹Ÿä¼šå»æ“ä½œå„ä¸ªèŠ‚ç‚¹çš„ç³»ç»Ÿè®¾ç½®<br>ererere
<a name=ofRxy></a></p><h2 id=æ¶æ„>æ¶æ„</h2><p>ä¸‰ä¸ªmasterï¼Œå¤šä¸ªnodeã€‚<br>kube-proxyå¼€å¯ipvsæ¨¡å¼é€šä¿¡ã€‚<br>æ‰€æœ‰ç»„ä»¶éƒ½å¾—ä¸kube-apiserveré€šä¿¡ï¼Œè¿™è¾¹åœ¨æ¯å°ä¸»æœºéƒ¨ç½²nginxå®¹å™¨ï¼Œå°†kube-apiserverçš„è®¿é—®ä»£ç†åˆ°åç«¯ä¸‰ä¸ªmasterä¸Šçš„kube-apiserver podä¸­å»ï¼Œå®ç°masteré«˜å¯ç”¨ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2020/svg/1176682/1593953281781-d132c23b-e537-4d74-80a4-6faf89bd7801.svg#align=left&display=inline&height=510&margin=%5Bobject%20Object%5D&name=k8s.svg&originHeight=150&originWidth=218&size=85958&status=done&style=none&width=741" alt=k8s.svg>
<a name=F1kUn></a></p><h3 id=masterçš„ç»„ä»¶>masterçš„ç»„ä»¶</h3><ul><li>etcd</li><li>kube-apiserver</li><li>kube-controller-manager</li><li>kube-scheduler</li><li>kubelet</li><li>kube-proxy</li><li>docker</li><li>nginx
<a name=JNO39></a></li></ul><h3 id=nodeçš„ç»„ä»¶>nodeçš„ç»„ä»¶</h3><ul><li>kubelet</li><li>kube-proxy</li><li>docker</li><li>nginx</li></ul><p><a name=cbb060fd></a></p><h2 id=ç¯å¢ƒå‡†å¤‡>ç¯å¢ƒå‡†å¤‡</h2><p><br>åœ¨æ‰€æœ‰èŠ‚ç‚¹æ“ä½œ<br></p><p><a name=e272bcd2></a></p><h3 id=æ‰€æœ‰ä¸»æœºç»Ÿä¸€hosts>æ‰€æœ‰ä¸»æœºç»Ÿä¸€hosts</h3><p>hostsç»Ÿä¸€å¦‚ä¸‹<br>ç³»ç»Ÿ<code>CentOS 7.6+</code>ä»¥ä¸Šï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨centos7.5ä»¥ä¸‹ï¼Œå®¹å™¨æŠ€æœ¯ä¾èµ–äºå†…æ ¸æŠ€æœ¯ï¼Œä½ç‰ˆæœ¬ç³»ç»Ÿéƒ¨ç½²å’Œè¿è¡Œåå¯èƒ½é—®é¢˜ä¼šéå¸¸å¤šã€‚</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>cat /etc/hosts

127.0.0.1 apiserver.k8s.local
192.168.33.101 master01
192.168.33.102 master02
192.168.33.103 master03
192.168.33.201 node01
192.168.33.202 node02
192.168.33.203 node03
</code></pre></div><table><thead><tr><th align=left>IP</th><th align=center>Hostname</th><th align=center>å†…æ ¸</th><th align=center>CPU</th><th align=center>Memory</th></tr></thead><tbody><tr><td align=left>192.168.33.101</td><td align=center>master01</td><td align=center>3.10.0-1062</td><td align=center>2</td><td align=center>4G</td></tr><tr><td align=left>192.168.33.102</td><td align=center>master02</td><td align=center>3.10.0-1062</td><td align=center>2</td><td align=center>4G</td></tr><tr><td align=left>192.168.33.103</td><td align=center>master03</td><td align=center>3.10.0-1062</td><td align=center>2</td><td align=center>4G</td></tr><tr><td align=left>192.168.33.201</td><td align=center>node01</td><td align=center>3.10.0-1062</td><td align=center>2</td><td align=center>4G</td></tr><tr><td align=left>192.168.33.202</td><td align=center>node02</td><td align=center>3.10.0-1062</td><td align=center>2</td><td align=center>4G</td></tr><tr><td align=left>192.168.33.203</td><td align=center>node03</td><td align=center>3.10.0-1062</td><td align=center>2</td><td align=center>4G</td></tr></tbody></table><ul><li>kubeadmå¥½åƒè¦æ±‚æœ€ä½é…ç½®2c2gè¿˜æ˜¯å¤šå°‘æ¥ç€ï¼Œè¶Šé«˜è¶Šå¥½</li><li>æ‰€æœ‰æ“ä½œå…¨éƒ¨ç”¨rootä½¿ç”¨è€…è¿›è¡Œï¼Œç³»ç»Ÿç›˜æ ¹ç›®å½•ä¸€å®šè¦å¤§ï¼Œä¸ç„¶åˆ°æ—¶å€™é•œåƒå¤šäº†ä¾‹å¦‚åˆ°äº†85%ä¼šè¢«gcå›æ”¶é•œåƒ</li><li>é«˜å¯ç”¨ä¸€èˆ¬å»ºè®®å¤§äºç­‰äº3å°çš„å¥‡æ•°å°,ä½¿ç”¨3å°<code>master</code>æ¥åšé«˜å¯ç”¨</li></ul><p><a name=BD1XW></a></p><h3 id=æ‰€æœ‰æœºå™¨å‡çº§å†…æ ¸å¯é€‰>æ‰€æœ‰æœºå™¨å‡çº§å†…æ ¸ï¼ˆå¯é€‰ï¼‰</h3><p>å¯¼å…¥å‡çº§å†…æ ¸çš„yumæº</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm
</code></pre></div><p>æŸ¥çœ‹å¯ç”¨ç‰ˆæœ¬ kernel-ltæŒ‡é•¿æœŸç¨³å®šç‰ˆ kernel-mlæŒ‡æœ€æ–°ç‰ˆ</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback> yum --disablerepo=&#34;*&#34; --enablerepo=&#34;elrepo-kernel&#34; list available
</code></pre></div><p>å®‰è£…kernel-ml</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>yum --enablerepo=elrepo-kernel install kernel-ml kernel-ml-devel -y
</code></pre></div><p><a name=R2POd></a></p><h4 id=è®¾ç½®å¯åŠ¨é¡¹>è®¾ç½®å¯åŠ¨é¡¹</h4><p>æŸ¥çœ‹ç³»ç»Ÿä¸Šçš„æ‰€æœ‰å¯ç”¨å†…æ ¸</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>awk -F\&#39; &#39;$1==&#34;menuentry &#34; {print i++ &#34; : &#34; $2}&#39; /etc/grub2.cfg
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1176682/1594196209080-1a691d50-bd6d-4f77-a304-1d1b3155b109.png#align=left&display=inline&height=103&margin=%5Bobject%20Object%5D&name=image.png&originHeight=206&originWidth=1219&size=37152&status=done&style=none&width=609.5" alt=image.png><br>è®¾ç½®æ–°çš„å†…æ ¸ä¸ºgrub2çš„é»˜è®¤ç‰ˆæœ¬</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>grub2-set-default &#39;CentOS Linux (5.7.7-1.el7.elrepo.x86_64) 7 (Core)&#39;
</code></pre></div><p><br>ç”Ÿæˆ grub é…ç½®æ–‡ä»¶å¹¶é‡å¯</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>reboot
</code></pre></div><p><br>é‡å¯å</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>uname -r
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1176682/1594196465931-fc7cf374-a5ef-4913-8ab6-746b708253f0.png#align=left&display=inline&height=46&margin=%5Bobject%20Object%5D&name=image.png&originHeight=92&originWidth=550&size=9538&status=done&style=none&width=275" alt=image.png>
<a name=17cc97ce></a></p><h3 id=æ‰€æœ‰æœºå™¨éƒ½å…³é—­é˜²ç«å¢™swapselinux>æ‰€æœ‰æœºå™¨éƒ½å…³é—­é˜²ç«å¢™ï¼Œswapï¼Œselinux</h3><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>#å…³é—­é˜²ç«å¢™
systemctl disable --now firewalld NetworkManager

#å…³é—­swap
swapoff -a
sed -ri &#39;/^[^#]*swap/s@^@#@&#39; /etc/fstab

#å…³é—­selinux
setenforce 0
sed -ri &#39;/^[^#]*SELINUX=/s#=.+$#=disabled#&#39; /etc/selinux/config
</code></pre></div><p><a name=7b3ef209></a></p><h3 id=æ‰€æœ‰æœºå™¨yumå‡†å¤‡>æ‰€æœ‰æœºå™¨yumå‡†å¤‡</h3><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>yum install epel-release -y

yum update -y
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>yum -y install  gcc bc gcc-c++ ncurses ncurses-devel cmake elfutils-libelf-devel openssl-devel flex* bison* autoconf automake zlib* fiex* libxml* ncurses-devel libmcrypt* libtool-ltdl-devel* make cmake  pcre pcre-devel openssl openssl-devel   jemalloc-devel tlc libtool vim unzip wget lrzsz bash-comp* ipvsadm ipset jq sysstat conntrack libseccomp conntrack-tools socat curl wget git conntrack-tools psmisc nfs-utils tree bash-completion conntrack libseccomp net-tools crontabs sysstat iftop nload strace bind-utils tcpdump htop telnet lsof 
</code></pre></div><p><a name=21d411b7></a></p><h3 id=æ‰€æœ‰æœºå™¨éƒ½åŠ è½½ipvs>æ‰€æœ‰æœºå™¨éƒ½åŠ è½½ipvs</h3><p>å†…æ ¸4.19åŠ4.19ä»¥ä¸Šçš„ç”¨è¿™ä¸ªipvsé…ç½®æ–‡ä»¶</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>:&gt; /etc/modules-load.d/ipvs.conf
module=(
ip_vs
ip_vs_rr
ip_vs_wrr
ip_vs_sh
nf_conntrack
br_netfilter
  )
for kernel_module in ${module[@]};do
    /sbin/modinfo -F filename $kernel_module |&amp; grep -qv ERROR &amp;&amp; echo $kernel_module &gt;&gt; /etc/modules-load.d/ipvs.conf || :
done
</code></pre></div><p><br>å†…æ ¸4.19ä»¥ä¸‹çš„ï¼Œä¸åŒ…æ‹¬4.19ï¼Œç”¨è¿™ä¸ªipvsé…ç½®æ–‡ä»¶</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>:&gt; /etc/modules-load.d/ipvs.conf
module=(
ip_vs
ip_vs_rr
ip_vs_wrr
ip_vs_sh
nf_conntrack_ipv4
br_netfilter
  )
for kernel_module in ${module[@]};do
    /sbin/modinfo -F filename $kernel_module |&amp; grep -qv ERROR &amp;&amp; echo $kernel_module &gt;&gt; /etc/modules-load.d/ipvs.conf || :
done
</code></pre></div><p><br>åŠ è½½ipvsæ¨¡å—</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>systemctl daemon-reload
systemctl enable --now systemd-modules-load.service
</code></pre></div><p><br>æŸ¥è¯¢ipvsæ˜¯å¦åŠ è½½</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>$ lsmod | grep ip_vs
ip_vs_sh               12688  0 
ip_vs_wrr              12697  0 
ip_vs_rr               12600  11 
ip_vs                 145497  17 ip_vs_rr,ip_vs_sh,ip_vs_wrr
nf_conntrack          133095  7 ip_vs,nf_nat,nf_nat_ipv4,xt_conntrack,nf_nat_masquerade_ipv4,nf_conntrack_netlink,nf_conntrack_ipv4
libcrc32c              12644  3 ip_vs,nf_nat,nf_conntrack
</code></pre></div><p><a name=279b9293></a></p><h3 id=æ‰€æœ‰æœºå™¨éƒ½è®¾ç½®k8sç³»ç»Ÿå‚æ•°>æ‰€æœ‰æœºå™¨éƒ½è®¾ç½®k8sç³»ç»Ÿå‚æ•°</h3><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf
net.ipv6.conf.all.disable_ipv6 = 1           #ç¦ç”¨ipv6
net.ipv6.conf.default.disable_ipv6 = 1       #ç¦ç”¨ipv6
net.ipv6.conf.lo.disable_ipv6 = 1            #ç¦ç”¨ipv6
net.ipv4.neigh.default.gc_stale_time = 120   #å†³å®šæ£€æŸ¥è¿‡æœŸå¤šä¹…é‚»å±…æ¡ç›®
net.ipv4.conf.all.rp_filter = 0              #å…³é—­åå‘è·¯ç”±æ ¡éªŒ
net.ipv4.conf.default.rp_filter = 0          #å…³é—­åå‘è·¯ç”±æ ¡éªŒ
net.ipv4.conf.default.arp_announce = 2       #å§‹ç»ˆä½¿ç”¨ä¸ç›®æ ‡IPåœ°å€å¯¹åº”çš„æœ€ä½³æœ¬åœ°IPåœ°å€ä½œä¸ºARPè¯·æ±‚çš„æºIPåœ°å€
net.ipv4.conf.lo.arp_announce = 2            #å§‹ç»ˆä½¿ç”¨ä¸ç›®æ ‡IPåœ°å€å¯¹åº”çš„æœ€ä½³æœ¬åœ°IPåœ°å€ä½œä¸ºARPè¯·æ±‚çš„æºIPåœ°å€
net.ipv4.conf.all.arp_announce = 2           #å§‹ç»ˆä½¿ç”¨ä¸ç›®æ ‡IPåœ°å€å¯¹åº”çš„æœ€ä½³æœ¬åœ°IPåœ°å€ä½œä¸ºARPè¯·æ±‚çš„æºIPåœ°å€
net.ipv4.ip_forward = 1                      #å¯ç”¨ipè½¬å‘åŠŸèƒ½
net.ipv4.tcp_max_tw_buckets = 5000           #è¡¨ç¤ºç³»ç»ŸåŒæ—¶ä¿æŒTIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡
net.ipv4.tcp_syncookies = 1                  #è¡¨ç¤ºå¼€å¯SYN Cookiesã€‚å½“å‡ºç°SYNç­‰å¾…é˜Ÿåˆ—æº¢å‡ºæ—¶ï¼Œå¯ç”¨cookiesæ¥å¤„ç†
net.ipv4.tcp_max_syn_backlog = 1024          #æ¥å—SYNåŒåŒ…çš„æœ€å¤§å®¢æˆ·ç«¯æ•°é‡
net.ipv4.tcp_synack_retries = 2              #æ´»åŠ¨TCPè¿æ¥é‡ä¼ æ¬¡æ•°
net.bridge.bridge-nf-call-ip6tables = 1      #è¦æ±‚iptableså¯¹bridgeçš„æ•°æ®è¿›è¡Œå¤„ç†
net.bridge.bridge-nf-call-iptables = 1       #è¦æ±‚iptableså¯¹bridgeçš„æ•°æ®è¿›è¡Œå¤„ç†
net.bridge.bridge-nf-call-arptables = 1      #è¦æ±‚iptableså¯¹bridgeçš„æ•°æ®è¿›è¡Œå¤„ç†
net.netfilter.nf_conntrack_max = 2310720     #ä¿®æ”¹æœ€å¤§è¿æ¥æ•°
fs.inotify.max_user_watches=89100            #åŒä¸€ç”¨æˆ·åŒæ—¶å¯ä»¥æ·»åŠ çš„watchæ•°ç›®
fs.may_detach_mounts = 1                     #å…è®¸æ–‡ä»¶å¸è½½
fs.file-max = 52706963                       #ç³»ç»Ÿçº§åˆ«çš„èƒ½å¤Ÿæ‰“å¼€çš„æ–‡ä»¶å¥æŸ„çš„æ•°é‡
fs.nr_open = 52706963                        #å•ä¸ªè¿›ç¨‹å¯åˆ†é…çš„æœ€å¤§æ–‡ä»¶æ•°
vm.overcommit_memory=1                       #è¡¨ç¤ºå†…æ ¸å…è®¸åˆ†é…æ‰€æœ‰çš„ç‰©ç†å†…å­˜ï¼Œè€Œä¸ç®¡å½“å‰çš„å†…å­˜çŠ¶æ€å¦‚ä½•
vm.panic_on_oom=0                            #å†…æ ¸å°†æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ä¾›åº”ç”¨è¿›ç¨‹ä½¿ç”¨
vm.swappiness = 0                            #å…³æ³¨swap
net.ipv4.tcp_keepalive_time = 600            #ä¿®å¤ipvsæ¨¡å¼ä¸‹é•¿è¿æ¥timeouté—®é¢˜,å°äº900å³å¯
net.ipv4.tcp_keepalive_intvl = 30            #æ¢æµ‹æ²¡æœ‰ç¡®è®¤æ—¶ï¼Œé‡æ–°å‘é€æ¢æµ‹çš„é¢‘åº¦
net.ipv4.tcp_keepalive_probes = 10           #åœ¨è®¤å®šè¿æ¥å¤±æ•ˆä¹‹å‰ï¼Œå‘é€å¤šå°‘ä¸ªTCPçš„keepaliveæ¢æµ‹åŒ…
vm.max_map_count=262144                      #å®šä¹‰äº†ä¸€ä¸ªè¿›ç¨‹èƒ½æ‹¥æœ‰çš„æœ€å¤šçš„å†…å­˜åŒºåŸŸ
EOF

sysctl --system
</code></pre></div><p><a name=c09a351c></a></p><h3 id=æ‰€æœ‰æœºå™¨éƒ½è®¾ç½®æ–‡ä»¶æœ€å¤§æ•°>æ‰€æœ‰æœºå™¨éƒ½è®¾ç½®æ–‡ä»¶æœ€å¤§æ•°</h3><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>cat&gt;/etc/security/limits.d/kubernetes.conf&lt;&lt;EOF
*       soft    nproc   131072
*       hard    nproc   131072
*       soft    nofile  131072
*       hard    nofile  131072
root    soft    nproc   131072
root    hard    nproc   131072
root    soft    nofile  131072
root    hard    nofile  131072
EOF
</code></pre></div><p><a name=9082a5d6></a></p><h3 id=æ‰€æœ‰æœºå™¨éƒ½è®¾ç½®docker-å®‰è£…>æ‰€æœ‰æœºå™¨éƒ½è®¾ç½®docker å®‰è£…</h3><p><a name=ceaf9f34></a></p><h4 id=docker-yum>docker yum</h4><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>cd /etc/yum.repos.d/  &amp;&amp;  wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre></div><p><a name=78cbf33b></a></p><h4 id=å®˜æ–¹è„šæœ¬æ£€æŸ¥>å®˜æ–¹è„šæœ¬æ£€æŸ¥</h4><p><br>dockerå®˜æ–¹çš„å†…æ ¸æ£€æŸ¥è„šæœ¬å»ºè®®<code>(RHEL7/CentOS7: User namespaces disabled; add 'user_namespace.enable=1' to boot command line)</code><br><br><img src="https://raw.githubusercontent.com/tangwei0928/picture01/master/20200104211718.png#align=left&display=inline&height=121&margin=%5Bobject%20Object%5D&originHeight=121&originWidth=702&status=done&style=none&width=702" alt><br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>grubby --args=&#34;user_namespace.enable=1&#34; --update-kernel=&#34;$(grubby --default-kernel)&#34;

#ç„¶åé‡å¯
reboot
</code></pre></div><p><a name=6232cdc9></a></p><h4 id=dockerå®‰è£…>dockerå®‰è£…</h4><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>yum install docker-ce -y
</code></pre></div><p><a name=c99bd83b></a></p><h4 id=é…ç½®docker>é…ç½®docker</h4><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>cp /usr/share/bash-completion/completions/docker /etc/bash_completion.d/

mkdir -p /etc/docker/

cat &gt; /etc/docker/daemon.json &lt;&lt;EOF
{
    &#34;log-driver&#34;: &#34;json-file&#34;,
    &#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;],
    &#34;log-opts&#34;: {
    &#34;max-size&#34;: &#34;100m&#34;,
    &#34;max-file&#34;: &#34;3&#34;
    },
    &#34;live-restore&#34;: true,
    &#34;max-concurrent-downloads&#34;: 10,
    &#34;max-concurrent-uploads&#34;: 10,
    &#34;registry-mirrors&#34;: [&#34;https://2lefsjdg.mirror.aliyuncs.com&#34;],
    &#34;storage-driver&#34;: &#34;overlay2&#34;,
    &#34;storage-opts&#34;: [
    &#34;overlay2.override_kernel_check=true&#34;
    ]
}
EOF
</code></pre></div><p><a name=f223c043></a></p><h4 id=å¯åŠ¨docker>å¯åŠ¨docker</h4><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>systemctl enable --now docker
</code></pre></div><p><a name=75d97f7f></a></p><h2 id=kubeadméƒ¨ç½²>kubeadméƒ¨ç½²</h2><p><a name=07df8c55></a></p><h3 id=æ‰€æœ‰æœºå™¨éƒ½è®¾ç½®kubeadm-yum>æ‰€æœ‰æœºå™¨éƒ½è®¾ç½®kubeadm yum</h3><p><br>åœ¨æ‰€æœ‰èŠ‚ç‚¹æ“ä½œ<br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>cat &lt;&lt;EOF &gt;/etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
EOF
</code></pre></div><p><a name=ce4ceb45></a></p><h3 id=maserèŠ‚ç‚¹å®‰è£…>maserèŠ‚ç‚¹å®‰è£…</h3><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>yum install -y \
    kubeadm-1.18.5 \
    kubectl-1.18.5 \
    kubelet-1.18.5 \
    --disableexcludes=kubernetes &amp;&amp; \
    systemctl enable kubelet
</code></pre></div><p><a name=2ac153da></a></p><h3 id=nodeèŠ‚ç‚¹å®‰è£…>nodeèŠ‚ç‚¹å®‰è£…</h3><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>yum install -y \
    kubeadm-1.18.5 \
    kubelet-1.18.5 \
    --disableexcludes=kubernetes &amp;&amp; \
    systemctl enable kubelet
</code></pre></div><p><a name=c91991ae></a></p><h3 id=masteré«˜å¯ç”¨>masteré«˜å¯ç”¨</h3><p><a name=pRKhb></a></p><h4 id=åœ¨æ‰€æœ‰èŠ‚ç‚¹éƒ¨ç½²ä¸€ä¸ªnginxå®¹å™¨>åœ¨æ‰€æœ‰èŠ‚ç‚¹éƒ¨ç½²ä¸€ä¸ªnginxå®¹å™¨</h4><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>mkdir -p /etc/kubernetes
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>cat &gt; /etc/kubernetes/nginx.conf &lt;&lt; EOF
user nginx nginx;
worker_processes auto;
events {
    worker_connections  20240;
    use epoll;
}
error_log /var/log/nginx_error.log info;
stream {
    upstream kube-servers {
        hash $remote_addr consistent;
        server master01:6443 weight=5 max_fails=1 fail_timeout=3s;
        server master02:6443 weight=5 max_fails=1 fail_timeout=3s;
        server master03:6443 weight=5 max_fails=1 fail_timeout=3s;
    }
    server {
        listen 8443 reuseport;
        proxy_connect_timeout 3s;
        proxy_timeout 3000s;
        proxy_pass kube-servers;
    }
}
EOF
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>docker run --restart=always \
    -v /etc/kubernetes/nginx.conf:/etc/nginx/nginx.conf \
    -v /etc/localtime:/etc/localtime:ro \
    --name k8sHA \
    --net host \
    -d \
    nginx
</code></pre></div><p><a name=d615260c></a></p><h3 id=kubeadmé…ç½®æ–‡ä»¶>kubeadmé…ç½®æ–‡ä»¶</h3><h3 id=kubeadm100å¹´è¯ä¹¦-ç¼–è¯‘å‚è€ƒhttpsgithubcom21kikubernetesblobmastergithubworkflowsgoyml>kubeadm100å¹´è¯ä¹¦ ç¼–è¯‘å‚è€ƒhttps://github.com/21ki/kubernetes/blob/master/.github/workflows/go.yml</h3><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>wget https://github.com/21ki/kubernetes/releases/download/v1.19.1/kubeadm-v1.19.1.zip
unzip kubeadm-v1.19.1.zip
chmod +x kubeadm
mv -f kubeadm /usr/bin/kubeadm
</code></pre></div><p><br>åœ¨master01èŠ‚ç‚¹æ“ä½œ<br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>cat &gt; /root/initconfig.yaml &lt;&lt; EOF
apiVersion: kubeadm.k8s.io/v1beta2
kind: ClusterConfiguration
imageRepository: registry.aliyuncs.com/k8sxio
kubernetesVersion: v1.18.5
certificatesDir: /etc/kubernetes/pki
clusterName: kubernetes
networking: 
  dnsDomain: cluster.local
  serviceSubnet: 169.0.0.0/12
  podSubnet: 10.0.0.0/8  ##Ciliumçš„podæ®µ
controlPlaneEndpoint: apiserver.k8s.local:8443
apiServer:
  timeoutForControlPlane: 4m0s
  extraArgs:
    authorization-mode: &#34;Node,RBAC&#34;
    enable-admission-plugins: &#34;NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeClaimResize,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,Priority,PodPreset&#34;
    runtime-config: api/all=true,settings.k8s.io/v1alpha1=true
    storage-backend: etcd3
    etcd-servers: https://192.168.33.101:2379,https://192.168.33.102:2379,https://192.168.33.103:2379 #ä¿®æ”¹å¯¹åº”çš„ip
  certSANs:
  - 10.96.0.1
  - 127.0.0.1
  - localhost
  - apiserver.k8s.local
  - 192.168.33.101 #ä¿®æ”¹å¯¹åº”çš„ip
  - 192.168.33.102 #ä¿®æ”¹å¯¹åº”çš„ip
  - 192.168.33.103 #ä¿®æ”¹å¯¹åº”çš„ip
  - master01       #ä¿®æ”¹å¯¹åº”çš„hostname
  - master02       #ä¿®æ”¹å¯¹åº”çš„hostname
  - master03       #ä¿®æ”¹å¯¹åº”çš„hostname
  - master
  - kubernetes
  - kubernetes.default 
  - kubernetes.default.svc 
  - kubernetes.default.svc.cluster.local
  extraVolumes:
  - hostPath: /etc/localtime
    mountPath: /etc/localtime
    name: localtime
    readOnly: true
controllerManager:
  extraArgs:
    bind-address: &#34;0.0.0.0&#34;
    experimental-cluster-signing-duration: 867000h
  extraVolumes:
  - hostPath: /etc/localtime
    mountPath: /etc/localtime
    name: localtime
    readOnly: true
scheduler: 
  extraArgs:
    bind-address: &#34;0.0.0.0&#34;
  extraVolumes:
  - hostPath: /etc/localtime
    mountPath: /etc/localtime
    name: localtime
    readOnly: true
dns:
  type: CoreDNS
  imageRepository: registry.aliyuncs.com/k8sxio
  imageTag: 1.7.0
etcd:
  local:
    imageRepository: registry.aliyuncs.com/k8sxio
    imageTag: 3.4.7
    dataDir: /var/lib/etcd
    serverCertSANs:
    - master
    - 192.168.33.101   #ä¿®æ”¹å¯¹åº”çš„ip
    - 192.168.33.102   #ä¿®æ”¹å¯¹åº”çš„ip
    - 192.168.33.103   #ä¿®æ”¹å¯¹åº”çš„ip
    - master01      #ä¿®æ”¹å¯¹åº”çš„hostname
    - master02      #ä¿®æ”¹å¯¹åº”çš„hostname
    - master03      #ä¿®æ”¹å¯¹åº”çš„hostname
    peerCertSANs:
    - master
    - 192.168.33.101     #ä¿®æ”¹å¯¹åº”çš„ip
    - 192.168.33.102     #ä¿®æ”¹å¯¹åº”çš„ip
    - 192.168.33.103     #ä¿®æ”¹å¯¹åº”çš„ip
    - master01           #ä¿®æ”¹å¯¹åº”çš„hostname
    - master02           #ä¿®æ”¹å¯¹åº”çš„hostname
    - master03           #ä¿®æ”¹å¯¹åº”çš„hostname
    extraArgs:
      auto-compaction-retention: &#34;1h&#34;
      max-request-bytes: &#34;33554432&#34;
      quota-backend-bytes: &#34;8589934592&#34;
      enable-v2: &#34;false&#34;
---
apiVersion: kubeproxy.config.k8s.io/v1alpha1
kind: KubeProxyConfiguration
mode: ipvs
ipvs:
  excludeCIDRs: null
  minSyncPeriod: 0s
  scheduler: &#34;rr&#34;
  strictARP: false
  syncPeriod: 15s
iptables:
  masqueradeAll: true
  masqueradeBit: 14
  minSyncPeriod: 0s
  syncPeriod: 30s
---
apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
cgroupDriver: &#34;systemd&#34;
failSwapOn: true
EOF
</code></pre></div><p><br>æ£€æŸ¥æ–‡ä»¶æ˜¯å¦é”™è¯¯ï¼Œå¿½ç•¥<code>warning</code>ï¼Œé”™è¯¯çš„è¯ä¼šæŠ›å‡ºerrorï¼Œæ²¡é”™åˆ™ä¼šè¾“å‡ºåˆ°åŒ…å«å­—ç¬¦ä¸²<code>kubeadm join xxx</code>å•¥çš„<br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubeadm init --config /root/initconfig.yaml --dry-run
</code></pre></div><p><br>é¢„å…ˆæ‹‰å–é•œåƒ<br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubeadm config images pull --config /root/initconfig.yaml
</code></pre></div><p><a name=292262c8></a></p><h3 id=éƒ¨ç½²master>éƒ¨ç½²master</h3><p><br>åœ¨master01èŠ‚ç‚¹æ“ä½œ<br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubeadm init --config /root/initconfig.yaml --upload-certs

...
...
...
You can now join any number of the control-plane node running the following command on each as root:

  kubeadm join apiserver.k8s.local:8443 --token 8lmdqu.cqe8r0rxa0056vmm \
    --discovery-token-ca-cert-hash sha256:5ca87fff6b414a0872ab5452972d7e36e4bad7ab3a0bc385abe0138ce671eabb \
    --control-plane --certificate-key 7a1d432b2834464a82fd7cba0e9e5d8409c492cf9a4ee6328fb4f84b6a78934a

Please note that the certificate-key gives access to cluster sensitive data, keep it secret!
As a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use 
&#34;kubeadm init phase upload-certs --upload-certs&#34; to reload certs afterward.

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join apiserver.k8s.local:8443 --token 8lmdqu.cqe8r0rxa0056vmm \
    --discovery-token-ca-cert-hash sha256:5ca87fff6b414a0872ab5452972d7e36e4bad7ab3a0bc385abe0138ce671eabb
</code></pre></div><p><br>å¤åˆ¶kubectlçš„kubeconfigï¼Œkubectlçš„kubeconfigè·¯å¾„é»˜è®¤æ˜¯<code>~/.kube/config</code><br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>mkdir -p $HOME/.kube

sudo cp /etc/kubernetes/admin.conf $HOME/.kube/config

sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre></div><p><br>initçš„yamlä¿¡æ¯å®é™…ä¸Šä¼šå­˜åœ¨é›†ç¾¤çš„configmapé‡Œï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶æŸ¥çœ‹ï¼Œè¯¥yamlåœ¨å…¶ä»–nodeå’Œmaster joinçš„æ—¶å€™ä¼šä½¿ç”¨åˆ°<br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubectl -n kube-system get cm kubeadm-config -o yaml
</code></pre></div><p><a name=bcaa46b0></a></p><h4 id=è®¾ç½®epçš„rbac>è®¾ç½®epçš„rbac</h4><p><br>kube-apiserverçš„webå¥åº·æ£€æŸ¥è·¯ç”±æœ‰æƒé™ï¼Œæˆ‘ä»¬éœ€è¦å¼€æ”¾ç”¨æ¥ç›‘æ§æˆ–è€…å¯¹æ¥SLBçš„å¥åº·æ£€æŸ¥<br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>cat &gt; /root/healthz-rbac.yml &lt;&lt; EOF
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: healthz-reader
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: healthz-reader
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: Group
  name: system:authenticated
- apiGroup: rbac.authorization.k8s.io
  kind: Group
  name: system:unauthenticated
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: healthz-reader
rules:
- nonResourceURLs: [&#34;/healthz&#34;, &#34;/healthz/*&#34;]
  verbs: [&#34;get&#34;, &#34;post&#34;]
EOF
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubectl apply -f /root/healthz-rbac.yml
</code></pre></div><p><a name=c1edf8ea></a></p><h4 id=é…ç½®å…¶ä»–masterçš„k8sç®¡ç†ç»„ä»¶>é…ç½®å…¶ä»–masterçš„k8sç®¡ç†ç»„ä»¶</h4><p>å°†master01ä¸Šçš„é…ç½®æ–‡ä»¶å‘åˆ°å…¶ä»–2ä¸ªmasterèŠ‚ç‚¹ä¸Š</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>for node in 192.168.33.102 192.168.33.103;do
    ssh $node &#39;mkdir -p /etc/kubernetes/pki/etcd&#39;
    scp -r /root/initconfig.yaml $node:/root/initconfig.yaml
    scp -r /etc/kubernetes/pki/ca.* $node:/etc/kubernetes/pki/
    scp -r /etc/kubernetes/pki/sa.* $node:/etc/kubernetes/pki/
    scp -r /etc/kubernetes/pki/front-proxy-ca.* $node:/etc/kubernetes/pki/
    scp -r /etc/kubernetes/pki/etcd/ca.* $node:/etc/kubernetes/pki/etcd/
done
</code></pre></div><p><a name=7d082cef></a></p><h4 id=å…¶ä»–master-joinè¿›æ¥>å…¶ä»–master joinè¿›æ¥</h4><p>å…ˆæ‹‰å–é•œåƒ</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubeadm config images pull --config /root/initconfig.yaml
</code></pre></div><p>æŸ¥çœ‹master01ä¸Š å¸¦æœ‰<code>--control-plane</code>çš„é‚£ä¸€è¡Œ</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubeadm join apiserver.k8s.local:8443 --token 8lmdqu.cqe8r0rxa0056vmm \
    --discovery-token-ca-cert-hash sha256:5ca87fff6b414a0872ab5452972d7e36e4bad7ab3a0bc385abe0138ce671eabb \
    --control-plane --certificate-key 7a1d432b2834464a82fd7cba0e9e5d8409c492cf9a4ee6328fb4f84b6a78934a
</code></pre></div><p><a name=6af224e5></a></p><h4 id=æ‰€æœ‰masteré…ç½®kubectl>æ‰€æœ‰masteré…ç½®kubectl</h4><p><a name=0bc22c29></a></p><h5 id=å‡†å¤‡kubectlçš„kubeconfig>å‡†å¤‡kubectlçš„kubeconfig</h5><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>mkdir -p $HOME/.kube

sudo cp /etc/kubernetes/admin.conf $HOME/.kube/config

sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre></div><p><a name=21aba698></a></p><h5 id=è®¾ç½®kubectlçš„è¡¥å…¨è„šæœ¬>è®¾ç½®kubectlçš„è¡¥å…¨è„šæœ¬</h5><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>yum -y install bash-comp*

source &lt;(kubectl completion bash)

echo &#39;source &lt;(kubectl completion bash)&#39; &gt;&gt; ~/.bashrc
</code></pre></div><p><a name=50981283></a></p><h4 id=masteré…ç½®etcdctl>masteré…ç½®etcdctl</h4><p><br>æ‰€æœ‰masterèŠ‚ç‚¹å…ˆå¤åˆ¶å‡ºå®¹å™¨é‡Œçš„etcdctl<br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>docker cp `docker ps -a | awk &#39;/k8s_etcd/{print $1}&#39;|head -n1`:/usr/local/bin/etcdctl /usr/local/bin/etcdctl
</code></pre></div><p><br>ç¼–å†™ä¸€ä¸ªç®€å•åˆ«åï¼Œè®°å¾—æ›¿æ¢å¯¹åº”çš„ip</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>cat &gt;/etc/profile.d/etcd.sh&lt;&lt;&#39;EOF&#39;
ETCD_CERET_DIR=/etc/kubernetes/pki/etcd/
ETCD_CA_FILE=ca.crt
ETCD_KEY_FILE=healthcheck-client.key
ETCD_CERT_FILE=healthcheck-client.crt
ETCD_EP=https://192.168.33.101:2379,https://192.168.33.102:2379,https://192.168.33.103:2379

alias etcd_v3=&#34;ETCDCTL_API=3 \
    etcdctl   \
   --cert ${ETCD_CERET_DIR}/${ETCD_CERT_FILE} \
   --key ${ETCD_CERET_DIR}/${ETCD_KEY_FILE} \
   --cacert ${ETCD_CERET_DIR}/${ETCD_CA_FILE} \
   --endpoints $ETCD_EP&#34;
EOF
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>source  /etc/profile.d/etcd.sh
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>etcd_v3 endpoint status --write-out=table

+-----------------------------+------------------+---------+---------+-----------+-----------+------------+
|          ENDPOINT           |        ID        | VERSION | DB SIZE | IS LEADER | RAFT TERM | RAFT INDEX |
+-----------------------------+------------------+---------+---------+-----------+-----------+------------+
| https://192.168.33.101:2379 | c724c500884441af |  3.4.7 |  1.6 MB |      true |         7 |       1865 |
| https://192.168.33.102:2379 | 3dcceec24ad5c5d4 |  3.4.7 |  1.6 MB |     false |         7 |       1865 |
| https://192.168.33.103:2379 | bc21062efb4a5d4c |  3.4.7 |  1.5 MB |     false |         7 |       1865 |
+-----------------------------+------------------+---------+---------+-----------+-----------+------------+
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>etcd_v3 endpoint health --write-out=table
+-----------------------------+--------+-------------+-------+
|          ENDPOINT           | HEALTH |    TOOK     | ERROR |
+-----------------------------+--------+-------------+-------+
| https://192.168.33.103:2379 |   true | 19.288026ms |       |
| https://192.168.33.102:2379 |   true |   19.2603ms |       |
| https://192.168.33.101:2379 |   true | 22.490443ms |       |
+-----------------------------+--------+-------------+-------+
</code></pre></div><p><br>é…ç½®etcdå¤‡ä»½è„šæœ¬<br>è®°å¾—æ›¿æ¢å¯¹åº”çš„ip</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>mkdir -p /opt/etcd

cat&gt;/opt/etcd/etcd_cron.sh<span class=s>&lt;&lt;&#39;EOF&#39;
</span><span class=s>#!/bin/bash
</span><span class=s>set -e
</span><span class=s>source  /etc/profile
</span><span class=s>export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
</span><span class=s>master=`ETCDCTL_API=3 etcdctl --endpoints=&#34;https://192.168.33.101:2379,https://192.168.33.102:2379,https://192.168.33.103:2379&#34; --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key --cacert=/etc/kubernetes/pki/etcd/ca.crt  endpoint status  | grep true|awk -F&#34;,&#34; &#39;{print $1}&#39;`
</span><span class=s>:  ${bak_dir:=/root/} #ç¼ºçœå¤‡ä»½ç›®å½•,å¯ä»¥ä¿®æ”¹æˆå­˜åœ¨çš„ç›®å½•
</span><span class=s>:  ${cert_dir:=/etc/kubernetes/pki/etcd/}
</span><span class=s>:  ${endpoints:=$master}
</span><span class=s>bak_prefix=&#39;etcd-&#39;
</span><span class=s>cmd_suffix=&#39;date +%Y-%m-%d-%H-%M&#39;
</span><span class=s>bak_suffix=&#39;.db&#39;
</span><span class=s>
</span><span class=s>#å°†è§„èŒƒåŒ–åçš„å‘½ä»¤è¡Œå‚æ•°åˆ†é…è‡³ä½ç½®å‚æ•°ï¼ˆ$1,$2,...)
</span><span class=s>temp=`getopt -n $0 -o c:d: -u -- &#34;$@&#34;`
</span><span class=s>
</span><span class=s>[ $? != 0 ] &amp;&amp; {
</span><span class=s>    echo &#39;
</span><span class=s>Examples:
</span><span class=s>  # just save once
</span><span class=s>  bash $0 /tmp/etcd.db
</span><span class=s>  # save in contab and  keep 5
</span><span class=s>  bash $0 -c 5
</span><span class=s>    &#39;
</span><span class=s>    exit 1
</span><span class=s>    }
</span><span class=s>
</span><span class=s>set -- $temp
</span><span class=s># -c å¤‡ä»½ä¿ç•™å‰¯æœ¬æ•°é‡
</span><span class=s># -d æŒ‡å®šå¤‡ä»½å­˜æ”¾ç›®å½•
</span><span class=s>
</span><span class=s>while true;do
</span><span class=s>    case &#34;$1&#34; in
</span><span class=s>        -c)
</span><span class=s>            [ -z &#34;$bak_count&#34; ] &amp;&amp; bak_count=$2
</span><span class=s>            printf -v null %d &#34;$bak_count&#34; &amp;&gt;/dev/null || \
</span><span class=s>                { echo &#39;the value of the -c must be number&#39;;exit 1; }
</span><span class=s>            shift 2
</span><span class=s>            ;;
</span><span class=s>        -d)
</span><span class=s>            [ ! -d &#34;$2&#34; ] &amp;&amp; mkdir -p $2
</span><span class=s>            bak_dir=$2
</span><span class=s>            shift 2
</span><span class=s>            ;;
</span><span class=s>         *)
</span><span class=s>            [[ -z &#34;$1&#34; || &#34;$1&#34; == &#39;--&#39; ]] &amp;&amp; { shift;break; }
</span><span class=s>            echo &#34;Internal error!&#34;
</span><span class=s>            exit 1
</span><span class=s>            ;;
</span><span class=s>    esac
</span><span class=s>done
</span><span class=s>
</span><span class=s>
</span><span class=s>
</span><span class=s>etcd::cron::save(){
</span><span class=s>    cd $bak_dir/
</span><span class=s>    ETCDCTL_API=3 etcdctl --endpoints=$endpoints --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key --cacert=/etc/kubernetes/pki/etcd/ca.crt  snapshot save  $bak_prefix$($cmd_suffix)$bak_suffix
</span><span class=s>    rm_files=`ls -t $bak_prefix*$bak_suffix | tail -n +$[bak_count+1]`
</span><span class=s>    if [ -n &#34;$rm_files&#34; ];then
</span><span class=s>        rm -f $rm_files
</span><span class=s>    fi
</span><span class=s>}
</span><span class=s>
</span><span class=s>main(){
</span><span class=s>    [ -n &#34;$bak_count&#34; ] &amp;&amp; etcd::cron::save || etcd_v3 snapshot save $@
</span><span class=s>}
</span><span class=s>
</span><span class=s>main $@
</span><span class=s>EOF</span>
</code></pre></div><p><br>crontab -eæ·»åŠ ä¸‹é¢å†…å®¹è‡ªåŠ¨ä¿ç•™å››ä¸ªå¤‡ä»½å‰¯æœ¬<br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>0 0 * * * bash /opt/etcd/etcd_cron.sh  -c 4 -d /opt/etcd/ &amp;&gt;/dev/null
</code></pre></div><p><a name=ab1dac9e></a></p><h3 id=éƒ¨ç½²node>éƒ¨ç½²node</h3><p><br>åœ¨nodeèŠ‚ç‚¹æ‰§è¡Œ<br><br>å’Œmasterçš„joinä¸€æ ·ï¼Œæå‰å‡†å¤‡å¥½ç¯å¢ƒå’Œdockerï¼Œç„¶åjoinçš„æ—¶å€™ä¸éœ€è¦å¸¦<code>--control-plane</code><br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubeadm join apiserver.k8s.local:8443 --token 8lmdqu.cqe8r0rxa0056vmm \
    --discovery-token-ca-cert-hash sha256:5ca87fff6b414a0872ab5452972d7e36e4bad7ab3a0bc385abe0138ce671eabb
</code></pre></div><p><a name=fedbcac8></a></p><h3 id=æ‰“æ ‡ç­¾>æ‰“æ ‡ç­¾</h3><p><br>roleåªæ˜¯ä¸€ä¸ªlabelï¼Œå¯ä»¥æ‰“labelï¼Œæƒ³æ˜¾ç¤ºå•¥å°±<code>node-role.kubernetes.io/xxxx</code><br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>[root@master01 ~]# kubectl get nodes
NAME       STATUS     ROLES    AGE   VERSION
master01   NotReady   master   17m   v1.18.5
master02   NotReady   master   14m   v1.18.5
master03   NotReady   master   13m   v1.18.5
node01     NotReady   &lt;none&gt;   24s   v1.18.5
node02     NotReady   &lt;none&gt;   18s   v1.18.5
node03     NotReady   &lt;none&gt;   11s   v1.18.5
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>[root@master01 ~]# kubectl label node node01 node-role.kubernetes.io/node=&#34;&#34;
node/node01 labeled
[root@master01 ~]# kubectl label node node02 node-role.kubernetes.io/node=&#34;&#34;
node/node02 labeled
[root@master01 ~]# kubectl label node node03 node-role.kubernetes.io/node=&#34;&#34;
node/node03 labeled

[root@master01 ~]# kubectl get nodes 
NAME       STATUS     ROLES    AGE     VERSION
master01   NotReady   master   25m     v1.18.5
master02   NotReady   master   22m     v1.18.5
master03   NotReady   master   21m     v1.18.5
node01     NotReady   node     8m      v1.18.5
node02     NotReady   node     7m54s   v1.18.5
node03     NotReady   node     7m47s   v1.18.5
</code></pre></div><p><a name=5550f7bc></a></p><h2 id=éƒ¨ç½²ç½‘ç»œæ’ä»¶cilium>éƒ¨ç½²ç½‘ç»œæ’ä»¶Cilium</h2><p><a name=czUsA></a></p><h3 id=å‡†å¤‡helm3>å‡†å¤‡helm3</h3><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>https://github.com/helm/helm/releases
</code></pre></div>é“¾æ¥: [https://pan.baidu.com/s/13qsdwCzaKfnZNlDarsBYpg](https://pan.baidu.com/s/13qsdwCzaKfnZNlDarsBYpg) æå–ç : wu22<div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>tar xvf helm-v3.3.0-rc.1-linux-amd64.tar
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>chmod +x linux-amd64/helm 
mv linux-amd64/helm  /usr/bin/
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1176682/1594439952860-de4aecf8-5f2b-4062-b6b4-750bf81bdccc.png#align=left&display=inline&height=106&margin=%5Bobject%20Object%5D&name=image.png&originHeight=106&originWidth=491&size=7265&status=done&style=none&width=491" alt=image.png>
<a name=UuH7B></a></p><h3 id=éƒ¨ç½²cilium>éƒ¨ç½²Cilium</h3><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>https://github.com/cilium/cilium
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>helm repo add cilium https://helm.cilium.io
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>helm install cilium cilium/cilium --version 1.8.1 \
   --namespace kube-system \
   --set global.nodeinit.enabled=true \
   --set global.externalIPs.enabled=true \
   --set global.nodePort.enabled=true \
   --set global.hostPort.enabled=true \
   --set global.pullPolicy=IfNotPresent \
   --set config.ipam=cluster-pool \
   --set global.hubble.enabled=true \
   --set global.hubble.listenAddress=&#34;:4244&#34; \
   --set global.hubble.relay.enabled=true \
   --set global.hubble.metrics.enabled=&#34;{dns,drop,tcp,flow,port-distribution,icmp,http}&#34; \
   --set global.prometheus.enabled=true \
   --set global.operatorPrometheus.enabled=true \
   --set global.hubble.ui.enabled=true
</code></pre></div><p><br>hubble-uié•œåƒä¸‹è½½<br>é“¾æ¥: <a href=https://pan.baidu.com/s/1gRVM37RjFyEebBfQ-1MyJQ>https://pan.baidu.com/s/1gRVM37RjFyEebBfQ-1MyJQ</a> æå–ç : gtyv
<a name=db06c78d></a></p><h2 id=heading></h2><p><a name=XYeYx></a></p><h2 id=æµ‹è¯•>æµ‹è¯•</h2><p><a name=cbdc82b1></a></p><h3 id=éªŒè¯é›†ç¾¤å¯ç”¨æ€§>éªŒè¯é›†ç¾¤å¯ç”¨æ€§</h3><p><br>æœ€åŸºæœ¬çš„3master3nodeé›†ç¾¤æ­å»ºå®Œæˆäº†<br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>[root@master01 ~]# kubectl get pods --all-namespaces -w
NAMESPACE     NAME                               READY   STATUS    RESTARTS   AGE
kube-system   cilium-4qs42                       1/1     Running   0          14m
kube-system   cilium-5v9xc                       1/1     Running   0          14m
kube-system   cilium-gw5nh                       1/1     Running   0          14m
kube-system   cilium-node-init-4cvlf             1/1     Running   0          14m
kube-system   cilium-node-init-4jxhb             1/1     Running   0          14m
kube-system   cilium-node-init-5m5ns             1/1     Running   0          14m
kube-system   cilium-node-init-klw8c             1/1     Running   0          14m
kube-system   cilium-node-init-kvgwp             1/1     Running   0          14m
kube-system   cilium-node-init-sc2wb             1/1     Running   0          14m
kube-system   cilium-nz8wc                       1/1     Running   0          14m
kube-system   cilium-operator-657978fb5b-j8bzv   1/1     Running   0          14m
kube-system   cilium-p6mzq                       1/1     Running   0          14m
kube-system   cilium-xchz5                       1/1     Running   0          14m
kube-system   coredns-84b99c4749-bb54k           1/1     Running   0          29m
kube-system   coredns-84b99c4749-q9z4r           1/1     Running   0          29m
kube-system   etcd-master01                      1/1     Running   0          29m
kube-system   etcd-master02                      1/1     Running   0          26m
kube-system   etcd-master03                      1/1     Running   0          26m
kube-system   hubble-relay-55c5cbdfcb-m4bx6      1/1     Running   0          11m
kube-system   hubble-ui-66fdcdc6d-czz8k          1/1     Running   0          14m
kube-system   kube-apiserver-master01            1/1     Running   0          29m
kube-system   kube-apiserver-master02            1/1     Running   0          27m
kube-system   kube-apiserver-master03            1/1     Running   0          25m
kube-system   kube-controller-manager-master01   1/1     Running   1          29m
kube-system   kube-controller-manager-master02   1/1     Running   0          27m
kube-system   kube-controller-manager-master03   1/1     Running   0          25m
kube-system   kube-proxy-9k98m                   1/1     Running   0          26m
kube-system   kube-proxy-ddhd4                   1/1     Running   0          25m
kube-system   kube-proxy-dqd45                   1/1     Running   0          25m
kube-system   kube-proxy-jbwtg                   1/1     Running   0          27m
kube-system   kube-proxy-mj75f                   1/1     Running   0          29m
kube-system   kube-proxy-xjpkd                   1/1     Running   0          25m
kube-system   kube-scheduler-master01            1/1     Running   1          29m
kube-system   kube-scheduler-master02            1/1     Running   0          27m
kube-system   kube-scheduler-master03            1/1     Running   0          25m
</code></pre></div><p><a name=j67Rf></a></p><h3 id=é‡å¯dockerkubelet>é‡å¯dockerï¼Œkubelet</h3><p>ç”±äºkubeadmé»˜è®¤ä½¿ç”¨cgoupfsï¼Œå®˜æ–¹æ¨èç”¨systemdï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½å¾—è¿›è¡Œæ£€æŸ¥å’Œä¿®æ”¹æˆsystemdï¼Œç„¶åé‡å¯dockerï¼Œkubelelt<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1176682/1593015648865-aa8e2229-aa2e-41ff-bf50-7d9dbad7d1ae.png#align=left&display=inline&height=334&margin=%5Bobject%20Object%5D&name=image.png&originHeight=334&originWidth=1075&size=30776&status=done&style=none&width=1075" alt=image.png></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>vim /var/lib/kubelet/kubeadm-flags.env

vim /etc/docker/daemon.json
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1176682/1593015747647-1c5d6eee-a8cb-47b1-8aed-eb97ad54dd19.png#align=left&display=inline&height=320&margin=%5Bobject%20Object%5D&name=image.png&originHeight=320&originWidth=972&size=29352&status=done&style=none&width=972" alt=image.png><br><br>æ‰€æœ‰èŠ‚ç‚¹å…ˆé‡å¯docker å†é‡å¯kubelet</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>systemctl restart docker
systemctl restart kubelet
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>[root@master01 ~]# kubectl get  nodes
NAME       STATUS   ROLES    AGE   VERSION
master01   Ready    master   37m   v1.18.5
master02   Ready    master   34m   v1.18.5
master03   Ready    master   33m   v1.18.5
node01     Ready    node     19m   v1.18.5
node02     Ready    node     19m   v1.18.5
node03     Ready    node     19m   v1.18.5
</code></pre></div><p><a name=demo></a></p><h3 id=demoæµ‹è¯•>demoæµ‹è¯•</h3><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>cat&lt;&lt;EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - image: nginx:alpine
        name: nginx
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: nginx
spec:
  selector:
    app: nginx
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
---
apiVersion: v1
kind: Pod
metadata:
  name: busybox
  namespace: default
spec:
  containers:
  - name: busybox
    image: busybox:1.28.4
    command:
      - sleep
      - &#34;3600&#34;
    imagePullPolicy: IfNotPresent
  restartPolicy: Always
EOF
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>[root@master01 ~]# kubectl get all  -o wide
NAME                         READY   STATUS    RESTARTS   AGE   IP               NODE     NOMINATED NODE   READINESS GATES
pod/busybox                  1/1     Running   0          73s   10.244.186.194   node03   &lt;none&gt;           &lt;none&gt;
pod/nginx-5c559d5697-24zck   1/1     Running   0          73s   10.244.186.193   node03   &lt;none&gt;           &lt;none&gt;

NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE   SELECTOR
service/kubernetes   ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP   42m   &lt;none&gt;
service/nginx        ClusterIP   10.111.219.3   &lt;none&gt;        80/TCP    73s   app=nginx

NAME                    READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         SELECTOR
deployment.apps/nginx   1/1     1            1           73s   nginx        nginx:alpine   app=nginx

NAME                               DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES         SELECTOR
replicaset.apps/nginx-5c559d5697   1         1         1       73s   nginx        nginx:alpine   app=nginx,pod-template-hash=5c559d5697
</code></pre></div><p><a name=439107f4></a></p><h4 id=éªŒè¯é›†ç¾¤dns>éªŒè¯é›†ç¾¤dns</h4><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>[root@master01 ~]# kubectl exec -ti busybox -- nslookup kubernetes
Server:		10.96.0.10
Address:	10.96.0.10#53

Name:	kubernetes.default.svc.cluster.local
Address: 10.96.0.1
</code></pre></div><p><a name=72f60fe4></a></p><h4 id=æµ‹è¯•nginxæ˜¯å¦é€š>æµ‹è¯•nginxæ˜¯å¦é€š</h4><p><br>åœ¨masterä¸Šcurl nginxçš„podçš„ipå‡ºç°nginxçš„indexå†…å®¹å³é›†ç¾¤æ­£å¸¸<br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>[root@master01 ~]# curl 10.244.186.193
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a href=&#34;http://nginx.org/&#34;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&#34;http://nginx.com/&#34;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p><br>åœ¨masterä¸Šcurl nginxçš„svcçš„ipå‡ºç°nginxçš„indexå†…å®¹å³é›†ç¾¤æ­£å¸¸<br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>[root@master01 ~]# curl 10.111.219.3
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a href=&#34;http://nginx.org/&#34;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&#34;http://nginx.com/&#34;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p><br><br></p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>[root@master01 ~]# kubectl exec -ti busybox -- nslookup nginx
Server:		10.96.0.10
Address:	10.96.0.10#53

Name:	nginx.default.svc.cluster.local
Address: 10.111.219.3
</code></pre></div><p><a name=009fab47></a></p><h4 id=ipvséªŒè¯>ipvséªŒè¯</h4><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>[root@node01 ~]# ipvsadm -ln
IP Virtual Server version 1.2.1 (size=4096)
Prot LocalAddress:Port Scheduler Flags
  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
TCP  10.96.0.1:443 rr
  -&gt; 192.168.33.101:6443          Masq    1      1          0         
  -&gt; 192.168.33.102:6443          Masq    1      0          0         
  -&gt; 192.168.33.103:6443          Masq    1      1          0         
TCP  10.96.0.10:53 rr
  -&gt; 10.244.140.65:53             Masq    1      0          0         
  -&gt; 10.244.140.67:53             Masq    1      0          0         
TCP  10.96.0.10:9153 rr
  -&gt; 10.244.140.65:9153           Masq    1      0          0         
  -&gt; 10.244.140.67:9153           Masq    1      0          0         
TCP  10.111.219.3:80 rr
  -&gt; 10.244.186.193:80            Masq    1      0          0         
UDP  10.96.0.10:53 rr
  -&gt; 10.244.140.65:53             Masq    1      0          0         
  -&gt; 10.244.140.67:53             Masq    1      0          0
</code></pre></div><p><a name=SMT45></a></p><h3 id=ç½‘ç»œå¯è§†åŒ–ç¥å™¨-hubble>ç½‘ç»œå¯è§†åŒ–ç¥å™¨ Hubble</h3><p>Â <code>Cilium</code>Â å¼ºå¤§ä¹‹å¤„å°±æ˜¯æä¾›äº†ç®€å•é«˜æ•ˆçš„ç½‘ç»œå¯è§†åŒ–åŠŸèƒ½ï¼Œå®ƒæ˜¯é€šè¿‡Â <strong>Hubble</strong>Â ç»„ä»¶å®Œæˆçš„ã€‚<strong>Cilium åœ¨ 1.7 ç‰ˆæœ¬åæ¨å‡ºå¹¶å¼€æºäº† Hubble</strong>ï¼Œå®ƒæ˜¯ä¸“é—¨ä¸ºç½‘ç»œå¯è§†åŒ–è®¾è®¡ï¼Œèƒ½å¤Ÿåˆ©ç”¨Â <code>Cilium</code>Â æä¾›çš„Â <code>eBPF</code>Â æ•°æ®è·¯å¾„ï¼Œè·å¾—å¯¹ Kubernetes åº”ç”¨å’ŒæœåŠ¡çš„ç½‘ç»œæµé‡çš„æ·±åº¦å¯è§æ€§ã€‚</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubectl edit svc -n kube-system  hubble-ui
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1176682/1594448142087-820ba694-af0a-46cf-af10-f07ad6cdf568.png#align=left&display=inline&height=305&margin=%5Bobject%20Object%5D&name=image.png&originHeight=305&originWidth=461&size=14334&status=done&style=none&width=461" alt=image.png><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1176682/1594451204489-5078f6fb-54fe-4afc-a63b-acd44961ee88.png#align=left&display=inline&height=1040&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1040&originWidth=1920&size=276479&status=done&style=none&width=1920" alt=image.png>
[è½¬è½½]https://www.yuque.com/xiaowei-trt7k/tw/ah0ls0</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>æ–‡ç« ä½œè€…</span>
<span class=item-content>ğŸ³Myki</span></p><p class=copyright-item><span class=item-title>ä¸Šæ¬¡æ›´æ–°</span>
<span class=item-content>2020-09-13</span></p></div><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-2427629508597494 data-ad-slot=2287897972 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>èµèµæ”¯æŒ</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=/img/reward/alipay.png>
<span>æ”¯ä»˜å®æ‰“èµ</span></label></div></div><footer class=post-footer><div class=post-tags><a href=/tags/kubernetes/>kubernetes</a></div><nav class=post-nav><a class=prev href=/post/markdown_hugo_commond/><i class="iconfont icon-left"></i><span class="prev-text nav-default">markdownæ³¨é‡Š hugoæ³¨é‡Š hemlæ³¨é‡Š</span>
<span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span></a>
<a class=next href=/post/ssl_certbot_install/><span class="next-text nav-default">ä½¿ç”¨ Certbot è‡ªåŠ¨ç”³è¯·å¹¶ç»­è®¢é˜¿é‡Œäº‘ DNS å…è´¹æ³›åŸŸåè¯ä¹¦ sslè¯ä¹¦</span>
<span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><div class="w3-panel w3-border w3-light-grey w3-round-large"><i class="fa fa-commenting w3-xxxlarge"></i><br><p class=w3-xlarge></p></div><script data-isso=https://isso.1nth.com/ data-isso-lang=zh src=https://isso.1nth.com/js/embed.min.js></script><section id=isso-thread></section><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname==='localhost')return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='mykifan';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:21kixc@gmail.com class="iconfont icon-email" title=email></a><a href=https://github.com/21ki class="iconfont icon-github" title=github></a><a href=http://localhost:1313 class="iconfont icon-weibo" title=weibo></a><a href=https://www.1nth.com/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><div class=busuanzi-footer><span id=busuanzi_container_site_pv>æœ¬ç«™æ€»è®¿é—®é‡ <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span> æ¬¡</span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv>æœ¬ç«™æ€»è®¿å®¢æ•° <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span> äºº</span></div><span class=copyright-year>&copy;
2018 -
2024<span class=heart><i class="iconfont icon-heart"></i></span><span>ğŸ³Myki</span><br></br></span></div></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/raphael@2.2.7/raphael.min.js integrity="sha256-67By+NpOtm9ka1R6xpUefeGOY8kWWHHRAKlvaTJ7ONI=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/flowchart.js@1.8.0/release/flowchart.min.js integrity="sha256-zNGWjubXoY6rb5MnmpBNefO0RgoVYfle9p0tvOQM+6k=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/snapsvg@0.5.1/dist/snap.svg-min.js integrity="sha256-oI+elz+sIm+jpn8F/qEspKoKveTc5uKeFHNNVexe6d8=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/underscore@1.8.3/underscore-min.js integrity="sha256-obZACiHd7gkOk9iIL/pimWMTJ4W/pBsKu+oZnSeBIek=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.js integrity=sha384-8748Vn52gHJYJI0XEuPB2QlPVNUkJlJn9tHqKec6J3q2r9l8fvRxrgn/E5ZHV0sP crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.css integrity=sha384-6QbLKJMz5dS3adWSeINZe74uSydBGFbnzaAYmp+tKyq60S7H2p6V7g1TysM5lAaF crossorigin=anonymous><script type=text/javascript src=/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-154483127-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script id=baidu_analytics>var _hmt=_hmt||[];(function(){if(window.location.hostname==='localhost')return;var hm=document.createElement("script");hm.async=true;hm.src="https://hm.baidu.com/hm.js?9f5f711a6a3e2fd392b4b02d93529765";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script><script id=baidu_push>(function(){if(window.location.hostname==='localhost')return;var bp=document.createElement('script');bp.async=true;var curProtocol=window.location.protocol.split(':')[0];if(curProtocol==='https'){bp.src='https://zz.bdstatic.com/linksubmit/push.js';}
else{bp.src='http://push.zhanzhang.baidu.com/push.js';}
var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script><script src=/js/custom.js></script></body></html>